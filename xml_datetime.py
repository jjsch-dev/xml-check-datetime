"""Utility to check the date and time in XML files generated by itktool.
"""

VERSION = '0.1.0'

import xml.etree.ElementTree as ET
from datetime import datetime
import argparse

parser = argparse.ArgumentParser(description="wiegand generator for MC-100")
parser.add_argument("--version", action="store_true", help="script version")
parser.add_argument("-f", "--filename", required=True, help="filename, select the XML parse, when the extension is xml.")

args = parser.parse_args()

if args.version:
    print("version {}".format(VERSION))


def parse_xml(name):
    try:
        tree = ET.parse(name)
        root = tree.getroot()
        index = 0
        invalid = 0
        for mark in root.findall('mark'):
            card_id = mark.find('access_id')
            date_time = mark.find('datetime')

            try:
                dt = datetime(year=int(date_time.find('year').text), month=int(date_time.find('month').text),
                              day=int(date_time.find('day').text), hour=int(date_time.find('hour').text),
                              minute=int(date_time.find('minute').text), second=int(date_time.find('seconds').text))
            except ValueError:
                invalid += 1
                print("mark:{} id:{} year:{} month:{} day:{} hour:{} minute:{} seconds: {}".format(index,
                                                                                                   card_id.text,
                                                                                                   date_time.find('year').text,
                                                                                                   date_time.find('month').text,
                                                                                                   date_time.find('day').text,
                                                                                                   date_time.find('hour').text,
                                                                                                   date_time.find('minute').text,
                                                                                                   date_time.find('seconds').text))
            index += 1

        print("records with invalid datetime {} of a total of {}".format(invalid, index))
    except FileNotFoundError:
        print("error file not found")

# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    parse_xml(args.filename)
